<!-- Patient Information Summary -->
<div class="p-6 bg-gradient-to-r from-blue-50 to-sky-100 rounded-2xl shadow-lg mb-8 text-center">
  <h2 class="text-xl font-bold text-blue-600 mb-6">Patient Information</h2>
  <div *ngIf="loading" class="text-center text-blue-500">Loading...</div>
  <div *ngIf="!loading && motherData">
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-9 gap-6 text-sm text-gray-700 text-left max-w-7xl mx-auto">
      <div><span class="font-semibold text-blue-500">Name:</span><br> {{ motherData?.name || 'N/A' }}</div>
      <div><span class="font-semibold text-blue-500">Home Address:</span><br> {{ motherData?.homeAddress || 'N/A' }}</div>
      <div><span class="font-semibold text-blue-500">Age:</span><br> {{ motherData?.age || 'N/A' }}</div>
      <div><span class="font-semibold text-blue-500">G:</span><br> {{ motherData?.g || 'N/A' }}</div>
      <div><span class="font-semibold text-blue-500">P:</span><br> {{ motherData?.p || 'N/A' }}</div>
      <div><span class="font-semibold text-blue-500">Hx:</span><br> {{ motherData?.hx || 'N/A' }}</div>
      <div><span class="font-semibold text-blue-500">LMP:</span><br> {{ motherData?.lmp || 'N/A' }}</div>
      <div><span class="font-semibold text-blue-500">Ultrasound:</span><br> {{ motherData?.ultrasound || 'N/A' }}</div>
      <div><span class="font-semibold text-blue-500">Contact Number:</span><br> {{ motherData?.contactNumber || 'N/A' }}</div>
    </div>
  </div>


</div>

<!-- Record Prenatal Container -->
<div class="p-6 bg-white rounded-xl shadow-lg max-h-full">
  <div class="flex justify-between items-center mb-4">
    <h2 class="text-2xl font-semibold text-blue-600">
      {{ showSubmittedRecords ? 'Submitted Records' : 'Record Prenatal' }}
    </h2>

    <!-- Toggle Button -->
    <button
      class="bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded-xl shadow transition"
      (click)="toggleSubmittedView()"
    >
      {{ showSubmittedRecords ? 'Prenatal Form' : 'Show Prenatal Records' }}
    </button>
  </div>

<!-- FORM SECTION -->
<div *ngIf="!showSubmittedRecords" class="h-full p-4 bg-slate-50 rounded-xl">
  <!-- Success Message -->
  <div *ngIf="successMessage" class="p-4 mb-4 text-white bg-green-500 border border-green-300 rounded-xl shadow-sm flex items-center gap-2" role="alert">
    <span class="font-semibold">Success!</span> {{ successMessage }}
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="p-4 mb-4 text-red-800 bg-red-50 border border-red-300 rounded-xl shadow-sm flex items-center gap-2" role="alert">
    <span class="font-semibold">Error:</span> {{ error }}
  </div>

  <!-- Pregnancy Form -->
  <form [formGroup]="pregnancyForm" (ngSubmit)="openConfirmModal()" class="max-w-7xl mx-auto bg-white rounded-2xl shadow-md p-6 sm:p-8 space-y-6">
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
      <div *ngFor="let col of columns" class="flex flex-col">
        <label [for]="col.key" class="text-sm font-medium text-gray-700 mb-1">{{ col.label }}</label>
        <input
          [type]="col.type"
          [formControlName]="col.key"
          [placeholder]="col.placeholder"
          [id]="col.key"
          class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:outline-none transition"
        />
      </div>
    </div>

    <!-- Submit Button -->
    <div class="flex justify-center">
      <button
        type="submit"
        [disabled]="pregnancyForm.invalid"
        class="bg-blue-600 text-white font-semibold px-6 py-3 rounded-xl shadow hover:bg-blue-700 transition disabled:opacity-50"
      >
        Save Record
      </button>
    </div>
  </form>
</div>


<!-- Submitted Records Section -->
<div *ngIf="showSubmittedRecords" class="mt-6">
  <h3 class="text-lg font-semibold mb-2 text-blue-700">{{motherData?.name}} Prenatal Records</h3>
<!-- Loading Message -->
<div *ngIf="loading" class="text-center text-blue-600 font-medium mb-4">
  Fetching patient prenatal records...
</div>

<!-- No Records Found -->
<div *ngIf="noRecordsFound && !loading" class="text-center text-red-500 font-semibold mb-4">
  No prenatal records found.
</div>

<!-- Prenatal Records List -->
<div *ngFor="let record of records; let i = index" class="bg-white shadow p-4 rounded-lg mb-3 border border-blue-100">
  <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2">
    <div *ngFor="let col of columns">
      <span class="text-gray-600 text-sm">{{ col.label }}:</span>
      <div class="font-medium text-gray-800">{{ record[col.key] || '-' }}</div>
    </div>
  </div>


    <!-- Action buttons -->
    <div class="flex justify-end gap-3 mt-4">
      <!-- Check if user has permission to edit or delete -->
      <ng-container *ngIf="canEditOrDelete(record); else noPermission">
        <button
          class="px-3 py-1 text-sm font-medium text-blue-700 border border-blue-300 rounded hover:bg-blue-100 transition"
          (click)="onEditRecord(i)">
          Edit
        </button>
        <button
          class="px-3 py-1 text-sm font-medium text-red-700 border border-red-300 rounded hover:bg-red-100 transition"
          (click)="onDeleteRecord(i)">
          Delete
        </button>
      </ng-container>

      <!-- No Permission message -->
      <ng-template #noPermission>
        <span class="cursor-pointer px-3 py-1 text-sm font-medium text-red-500 border border-red-300 rounded hover:bg-red-100 transition">You cannot edit or delete this record.</span>
      </ng-template>
    </div>
  </div>
</div>


</div>








<!-- CONFIRMATION MODAL -->
<div *ngIf="showConfirmationModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm">
  <div class="bg-white rounded-2xl shadow-lg p-6 max-w-7xl mx-4 w-full">
    <h2 class="text-lg font-semibold mb-4 text-center">Confirm Your Details</h2>

    <!-- Modal Content - 3 Column Layout -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
      <div *ngFor="let col of columns" class="flex flex-col">
        <div class="font-medium text-gray-700 mb-1">{{ col.label }}:</div>
        <div class="text-sm text-gray-500">{{ formDataPreview[col.key] || 'N/A' }}</div>
      </div>
    </div>

    <!-- Modal Buttons -->
    <div class="mt-6 flex justify-end gap-4">
      <button (click)="cancelConfirmation()" class="text-gray-500 bg-gray-100 px-4 py-2 rounded-xl">Cancel</button>
      <button (click)="confirmAndSubmit()" class="bg-blue-600 text-white px-6 py-2 rounded-xl">Confirm & Submit</button>
    </div>
  </div>
</div>
